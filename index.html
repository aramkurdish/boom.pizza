<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Boom's Pizza | Ø¨ÙˆÙ… Ù¾ÛŒØªØ²Ø§</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #0a0a0a;
            color: #ffffff;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #0a0a0a;
        }
        ::-webkit-scrollbar-thumb {
            background: #ff3131;
            border-radius: 10px;
        }
        @keyframes pulse-gold {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 20px 10px rgba(255, 193, 7, 0); }
        }
        .animate-pulse-gold {
            animation: pulse-gold 2s infinite;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .lucky-wheel-canvas {
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
        }
        .receipt-pattern {
            background-color: #ffffff;
            background-image:  linear-gradient(135deg, #f5f5f5 25%, transparent 25%), linear-gradient(225deg, #f5f5f5 25%, transparent 25%), linear-gradient(45deg, #f5f5f5 25%, transparent 25%), linear-gradient(315deg, #f5f5f5 25%, #ffffff 25%);
            background-position:  10px 0, 10px 0, 0 0, 0 0;
            background-size:  20px 20px;
            background-repeat: repeat;
        }
    </style>
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom": "https://esm.sh/react-dom@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
            "firebase/database": "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js",
            "lucide-react": "https://esm.sh/lucide-react@0.344.0?external=react",
            "htm": "https://esm.sh/htm@3.1.1"
        }
    }
    </script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useRef, useCallback, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { getDatabase, ref, onValue, push, set, update, remove, query, orderByChild, equalTo } from 'firebase/database';
        import * as Lucide from 'lucide-react';
        import htm from 'htm';

        const html = htm.bind(React.createElement);

        // --- Firebase Setup ---
        const firebaseConfig = {
            apiKey: "AIzaSyDqoOjm4m1Fxp760mJPy0sv5_NjaJfkm7g",
            authDomain: "boompizza-5d048.firebaseapp.com",
            databaseURL: "https://boompizza-5d048-default-rtdb.firebaseio.com",
            projectId: "boompizza-5d048",
            storageBucket: "boompizza-5d048.firebasestorage.app",
            messagingSenderId: "636068289590",
            appId: "1:636068289590:web:41fe758906140c700ecc97"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- Icon Component Proxy ---
        const Icon = ({ name, ...props }) => {
            const LucideIcon = Lucide[name];
            return LucideIcon ? html`<${LucideIcon} ...${props} />` : null;
        };

        // --- Digital Receipt Component ---
        const DigitalReceipt = ({ order, onClose }) => {
            return html`
                <div className="fixed inset-0 z-[7000] bg-black/95 flex items-center justify-center p-4">
                    <div className="bg-white text-black w-full max-w-sm rounded-3xl overflow-hidden shadow-2xl flex flex-col items-center p-6 relative">
                        <div className="absolute top-0 left-0 w-full h-2 bg-[#ff3131]"></div>
                        
                        <div className="bg-green-100 text-green-600 p-3 rounded-full mb-4">
                            <${Icon} name="CheckCircle" size=${32} />
                        </div>
                        
                        <h2 className="text-2xl font-black mb-1">ÙˆÛ•Ø³ÚµÛŒ Ø¯ÛŒØ¬ÛŒØªØ§ÚµÛŒ</h2>
                        <p className="text-gray-500 text-sm mb-6">Ø³ÙˆÙ¾Ø§Ø³ Ø¨Û† Ù…ØªÙ…Ø§Ù†Û•Ú©Û•Øª!</p>
                        
                        <div className="w-full border-t border-dashed border-gray-300 py-4 space-y-3">
                            <div className="flex justify-between text-sm">
                                <span className="text-gray-500">Ú©Û†Ø¯ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ:</span>
                                <span className="font-bold">#${order.orderID}</span>
                            </div>
                            <div className="flex justify-between text-sm">
                                <span className="text-gray-500">Ú©Ø§Øª:</span>
                                <span className="font-bold">${order.time}</span>
                            </div>
                            <div className="flex flex-col gap-1 mt-2">
                                <span className="text-gray-500 text-sm">Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†:</span>
                                <span className="font-bold text-sm bg-gray-50 p-2 rounded-lg">${order.items}</span>
                            </div>
                            <div className="flex justify-between items-center pt-4 border-t border-gray-200 mt-4">
                                <span className="text-lg font-bold">Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ:</span>
                                <span className="text-2xl font-black text-[#ff3131]">${order.total} Ø¯.Ø¹</span>
                            </div>
                        </div>

                        <div className="w-full mt-6 space-y-3">
                            <button 
                                onClick=${() => {
                                    const msg = `ğŸ†” # ${order.orderID}\nğŸ´ ${order.items}\nğŸ’° ${order.total} Ø¯.Ø¹\nğŸ“ ${order.location}\nğŸ“ ${order.note || "Ø¨Û•Ø¨Û ØªÛØ¨ÛŒÙ†ÛŒ"}`;
                                    window.location.href = `https://wa.me/9647504629237?text=${encodeURIComponent(msg)}`;
                                }}
                                className="w-full bg-[#25D366] text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2"
                            >
                                <${Icon} name="MessageCircle" size=${18} /> Ù†Ø§Ø±Ø¯Ù†ÛŒ Ú©Û†ØªØ§ÛŒÛŒ Ø¨Û† ÙˆØ§ØªØ³Ø¦Û•Ù¾
                            </button>
                            <button 
                                onClick=${onClose}
                                className="w-full bg-gray-100 text-gray-600 font-bold py-3 rounded-xl"
                            >
                                Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ• Ø¨Û† Ù…ÛÙ†Û†
                            </button>
                        </div>
                    </div>
                </div>
            `;
        };

        const LuckyWheel = ({ onWin, onClose }) => {
            const [isSpinning, setIsSpinning] = useState(false);
            const canvasRef = useRef(null);
            const [rotation, setRotation] = useState(0);

            const PRIZES = useMemo(() => [
                { label: "%5 Ø¯Ø§Ø´Ú©Ø§Ù†", color: "#ff3131", prob: 60 },
                { label: "Ú©Û†Ù„Ø§ÛŒ Ø¨Û•Ù„Ø§Ø´", color: "#ffc107", prob: 20 },
                { label: "%10 Ø¯Ø§Ø´Ú©Ø§Ù†", color: "#161616", prob: 10 },
                { label: "Ø¨ÙˆÙ… Ù¾ÛŒØªØ²Ø§", color: "#25D366", prob: 5 },
                { label: "Ø¯ÛŒØ§Ø±ÛŒ ØªØ§ÛŒØ¨Û•Øª", color: "#444444", prob: 5 }
            ], []);

            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                const arc = (2 * Math.PI) / PRIZES.length;
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                PRIZES.forEach((p, i) => {
                    ctx.beginPath();
                    ctx.fillStyle = p.color;
                    ctx.moveTo(175, 175);
                    ctx.arc(175, 175, 170, i * arc, (i + 1) * arc);
                    ctx.fill();
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    ctx.save();
                    ctx.translate(175, 175);
                    ctx.rotate(i * arc + arc / 2);
                    ctx.textAlign = "right";
                    ctx.fillStyle = "white";
                    ctx.font = "bold 14px Vazirmatn";
                    ctx.fillText(p.label, 150, 5);
                    ctx.restore();
                });
            }, [PRIZES]);

            const spin = () => {
                if (isSpinning) return;
                setIsSpinning(true);

                const rand = Math.random() * 100;
                let cumulative = 0;
                let winnerIndex = 0;
                for (let i = 0; i < PRIZES.length; i++) {
                    cumulative += PRIZES[i].prob;
                    if (rand <= cumulative) {
                        winnerIndex = i;
                        break;
                    }
                }

                const degPerSlice = 360 / PRIZES.length;
                const targetAngle = 270 - (winnerIndex * degPerSlice + degPerSlice / 2);
                const extraSpins = 10 * 360;
                const newRotation = rotation + extraSpins + (targetAngle - (rotation % 360));

                setRotation(newRotation);

                setTimeout(() => {
                    setIsSpinning(false);
                    onWin(PRIZES[winnerIndex].label);
                }, 5000);
            };

            return html`
                <div className="fixed inset-0 z-[6000] bg-black/90 flex flex-col items-center justify-center p-4">
                    <button onClick=${onClose} className="absolute top-6 right-6 text-white text-3xl hover:text-red-500 transition-colors">âœ•</button>
                    <div className="relative mb-8">
                        <div className="absolute top-[-15px] left-1/2 -translate-x-1/2 w-0 h-0 border-l-[15px] border-l-transparent border-r-[15px] border-r-transparent border-t-[30px] border-t-red-500 z-10 drop-shadow-lg"></div>
                        <canvas 
                            ref=${canvasRef} 
                            width="350" 
                            height="350" 
                            className="rounded-full border-[8px] border-[#333] shadow-2xl transition-transform duration-[5000ms] lucky-wheel-canvas"
                            style=${{ transitionTimingFunction: 'cubic-bezier(0.15, 0, 0.15, 1)', transform: `rotate(${rotation}deg)` }}
                        />
                    </div>
                    <button
                        onClick=${spin}
                        disabled=${isSpinning}
                        className=${`px-12 py-4 rounded-full font-bold text-xl text-white transition-all ${isSpinning ? 'bg-gray-600' : 'bg-[#ff3131] hover:scale-110 shadow-lg shadow-red-500/20'}`}
                    >
                        ${isSpinning ? 'Ø¯Û•Ø³ÙˆÚ•ÛØªÛ•ÙˆÛ•...' : 'Ø¨Ø³ÙˆÚ•ÛÙ†Û•! ğŸ°'}
                    </button>
                    <p className="mt-6 text-gray-400 text-sm">Ø¨Û•Ø®ØªÛŒ Ø®Û†Øª ØªØ§Ù‚ÛŒ Ø¨Ú©Û•Ø±Û•ÙˆÛ• Ø¨Û† Ø¨Û•Ø¯Û•Ø³ØªÙ‡ÛÙ†Ø§Ù†ÛŒ Ø®Û•ÚµØ§ØªÛŒ Ø´Ø§ÛŒØ³ØªÛ•!</p>
                </div>
            `;
        };

        const AdminPanel = () => {
            const [activeTab, setActiveTab] = useState('orders');
            const [menuItems, setMenuItems] = useState([]);
            const [orders, setOrders] = useState([]);
            const [editingItem, setEditingItem] = useState({ name: '', price: 0, discount: 0, img: '', category: 'pizza' });

            useEffect(() => {
                const unsubMenu = onValue(ref(db, 'menu_items'), (snapshot) => {
                    const data = snapshot.val();
                    setMenuItems(data ? Object.entries(data).map(([id, val]) => ({ ...val, id })) : []);
                });
                const unsubOrders = onValue(ref(db, 'orders'), (snapshot) => {
                    const data = snapshot.val();
                    const list = data ? Object.entries(data).map(([id, val]) => ({ ...val, id })) : [];
                    setOrders(list.reverse());
                });
                return () => { unsubMenu(); unsubOrders(); };
            }, []);

            const handleSaveItem = async (e) => {
                e.preventDefault();
                if (!editingItem.name || !editingItem.price) return alert("ØªÚ©Ø§ÛŒÛ• Ù‡Û•Ù…ÙˆÙˆ Ø®Ø§Ù†Û•Ú©Ø§Ù† Ù¾Ú•Ø¨Ú©Û•Ø±Û•ÙˆÛ•");
                try {
                    if (editingItem.id) {
                        const { id, ...data } = editingItem;
                        await update(ref(db, `menu_items/${id}`), data);
                    } else {
                        await push(ref(db, 'menu_items'), editingItem);
                    }
                    setEditingItem({ name: '', price: 0, discount: 0, img: '', category: 'pizza' });
                } catch (err) {
                    alert("Ù‡Û•ÚµÛ• Ú•ÙˆÙˆÛŒØ¯Ø§ Ù„Û• Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø¯Ù†");
                }
            };

            return html`
                <div className="p-4 max-w-5xl mx-auto pb-24">
                    <div className="flex gap-4 mb-8 bg-zinc-900 p-2 rounded-xl border border-zinc-800">
                        <button onClick=${() => setActiveTab('orders')} className=${`flex-1 py-3 rounded-lg font-bold transition-all ${activeTab === 'orders' ? 'bg-[#ff3131] text-white shadow-lg' : 'text-zinc-400 hover:bg-zinc-800'}`}>ğŸ“¥ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù† (${orders.length})</button>
                        <button onClick=${() => setActiveTab('items')} className=${`flex-1 py-3 rounded-lg font-bold transition-all ${activeTab === 'items' ? 'bg-[#ff3131] text-white shadow-lg' : 'text-zinc-400 hover:bg-zinc-800'}`}>âš™ï¸ Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ Ù…ÛÙ†Û†</button>
                    </div>

                    ${activeTab === 'orders' ? html`
                        <div className="space-y-4">
                            <h2 className="text-2xl font-bold mb-4 text-[#ffc107]">Ù„ÛŒØ³ØªÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†</h2>
                            ${orders.length === 0 ? html`<div className="text-center py-20 text-zinc-500">Ù‡ÛŒÚ† Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú© Ù†ÛŒÛŒÛ•</div>` :
                            orders.map(o => html`
                                <div key=${o.id} className="bg-zinc-900 border border-zinc-800 p-6 rounded-2xl shadow-xl mb-4">
                                    <div className="flex justify-between items-start mb-4">
                                        <div>
                                            <span className="text-[#ff3131] font-bold text-lg ml-2">ğŸ†” #${o.orderID}</span>
                                            <span className="text-zinc-500 text-sm">â° ${o.time}</span>
                                        </div>
                                        <button onClick=${() => remove(ref(db, `orders/${o.id}`))} className="p-2 text-zinc-500 hover:text-green-500 transition-colors">
                                            <${Icon} name="CheckCircle" size=${24} />
                                        </button>
                                    </div>
                                    <div className="space-y-2 text-zinc-300">
                                        <p><span className="text-zinc-500 font-bold ml-1">Ø®ÙˆØ§Ø±Ø¯Ù†Û•Ú©Ø§Ù†:</span> <span className="text-white">${o.items}</span></p>
                                        <p><span className="text-zinc-500 font-bold ml-1">Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ:</span> <span className="text-[#ffc107] font-bold">${o.total} Ø¯.Ø¹</span></p>
                                        <p><span className="text-zinc-500 font-bold ml-1">ØªÛØ¨ÛŒÙ†ÛŒ:</span> <span>${o.note || "Ù†ÛŒÛŒÛ•"}</span></p>
                                    </div>
                                    <div className="mt-6">
                                        <a href=${o.location} target="_blank" className="flex bg-blue-600/20 text-blue-400 border border-blue-600/30 py-3 rounded-xl items-center justify-center gap-2 font-bold hover:bg-blue-600/30 transition-all">
                                            <${Icon} name="ExternalLink" size=${18} /> Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ù„Û†Ú©Û•ÛŒØ´Ù†
                                        </a>
                                    </div>
                                </div>
                            `)}
                        </div>
                    ` : html`
                        <div className="space-y-8">
                            <form onSubmit=${handleSaveItem} className="bg-zinc-900 p-6 rounded-2xl border border-zinc-800 space-y-4">
                                <h2 className="text-xl font-bold text-white flex items-center gap-2">
                                    <${Icon} name=${editingItem.id ? 'Edit' : 'Plus'} size=${20} />
                                    ${editingItem.id ? 'Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ Ø®ÙˆØ§Ø±Ø¯Ù†' : 'Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø®ÙˆØ§Ø±Ø¯Ù†ÛŒ Ù†ÙˆÛ'}
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <input type="text" placeholder="Ù†Ø§ÙˆÛŒ Ø®ÙˆØ§Ø±Ø¯Ù†" className="w-full bg-zinc-800 border border-zinc-700 p-3 rounded-xl text-white outline-none focus:border-[#ff3131]" value=${editingItem.name} onChange=${e => setEditingItem({ ...editingItem, name: e.target.value })} />
                                    <input type="number" placeholder="Ù†Ø±Ø®" className="w-full bg-zinc-800 border border-zinc-700 p-3 rounded-xl text-white outline-none focus:border-[#ff3131]" value=${editingItem.price || ''} onChange=${e => setEditingItem({ ...editingItem, price: parseInt(e.target.value) })} />
                                    <input type="number" placeholder="Ø¯Ø§Ø´Ú©Ø§Ù†" className="w-full bg-zinc-800 border border-zinc-700 p-3 rounded-xl text-white outline-none focus:border-[#ff3131]" value=${editingItem.discount || ''} onChange=${e => setEditingItem({ ...editingItem, discount: parseInt(e.target.value) })} />
                                    <select className="w-full bg-zinc-800 border border-zinc-700 p-3 rounded-xl text-white outline-none focus:border-[#ff3131]" value=${editingItem.category} onChange=${e => setEditingItem({ ...editingItem, category: e.target.value })}>
                                        ${['pizza', 'burger', 'shawarma', 'finger', 'drink'].map(c => html`<option key=${c} value=${c}>${c}</option>`)}
                                    </select>
                                    <input type="text" placeholder="Ù„ÛÙ†Ú©ÛŒ ÙˆÛÙ†Û•" className="w-full bg-zinc-800 border border-zinc-700 p-3 rounded-xl text-white outline-none focus:border-[#ff3131] md:col-span-2" value=${editingItem.img} onChange=${e => setEditingItem({ ...editingItem, img: e.target.value })} />
                                </div>
                                <button className="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-xl shadow-lg transition-all">
                                    ${editingItem.id ? 'Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø¯Ù†ÛŒ Ú¯Û†Ú•Ø§Ù†Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†' : 'Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø®ÙˆØ§Ø±Ø¯Ù†'}
                                </button>
                                ${editingItem.id && html`<button type="button" onClick=${() => setEditingItem({ name: '', price: 0, discount: 0, img: '', category: 'pizza' })} className="w-full bg-zinc-800 text-zinc-400 py-2 rounded-xl">Ù„Ø§Ø¨Ø±Ø¯Ù†</button>`}
                            </form>

                            <div className="space-y-4">
                                <h2 className="text-xl font-bold text-white">Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù† (${menuItems.length})</h2>
                                ${menuItems.map(item => html`
                                    <div key=${item.id} className="bg-zinc-900 border border-zinc-800 p-4 rounded-xl flex items-center justify-between mb-2 shadow-md">
                                        <div className="flex items-center gap-4">
                                            <img src=${item.img || 'https://via.placeholder.com/150'} className="w-12 h-12 rounded-full object-cover border border-zinc-700" />
                                            <div>
                                                <h4 className="font-bold text-white">${item.name}</h4>
                                                <p className="text-xs text-zinc-500">${item.price} Ø¯.Ø¹ - ${item.category}</p>
                                            </div>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick=${() => { setEditingItem(item); window.scrollTo({top: 0, behavior: 'smooth'}); }} className="p-2 text-blue-400 hover:bg-blue-400/10 rounded-lg"><${Icon} name="Edit" size=${20} /></button>
                                            <button onClick=${() => remove(ref(db, `menu_items/${item.id}`))} className="p-2 text-red-500 hover:bg-red-500/10 rounded-lg"><${Icon} name="Trash2" size=${20} /></button>
                                        </div>
                                    </div>
                                `)}
                            </div>
                        </div>
                    `}
                </div>
            `;
        };

        const App = () => {
            const [view, setView] = useState('menu');
            const [activeCategory, setActiveCategory] = useState('pizza');
            const [menuItems, setMenuItems] = useState([]);
            const [cart, setCart] = useState({});
            const [showWheel, setShowWheel] = useState(false);
            const [prizes, setPrizes] = useState([]);
            const [orderNote, setOrderNote] = useState('');
            const [isSending, setIsSending] = useState(false);
            const [lastOrder, setLastOrder] = useState(null);

            const CATEGORIES = useMemo(() => [
                { id: 'pizza', name: 'Ù¾ÛŒØªØ²Ø§', img: 'https://images.unsplash.com/photo-1513104890138-7c749659a591?w=150' },
                { id: 'burger', name: 'Ø¨Û•Ø±Ú¯Ø±', img: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=150' },
                { id: 'shawarma', name: 'Ø´Ø§ÙˆÛ•Ø±Ù…Û•', img: 'https://i.postimg.cc/Pr91C9Z7/arabic-chicken-shawarma-sandwich-recipe-1747792750.jpg' },
                { id: 'finger', name: 'Ù¾Û•Ù†Ø¬Û•Ú©Ø§Ù†', img: 'https://i.postimg.cc/FHWp2K1z/fried-chicken-fingers.jpg' },
                { id: 'drink', name: 'Ø®ÙˆØ§Ø±Ø¯Ù†Û•ÙˆÛ•', img: 'https://images.unsplash.com/photo-1622483767028-3f66f32aef97?w=150' }
            ], []);

            useEffect(() => {
                const unsub = onValue(query(ref(db, 'menu_items'), orderByChild('category'), equalTo(activeCategory)), (snapshot) => {
                    const data = snapshot.val();
                    setMenuItems(data ? Object.entries(data).map(([id, val]) => ({ ...val, id })) : []);
                });
                return () => unsub();
            }, [activeCategory]);

            const canSpin = localStorage.getItem('canSpinBoom') === 'true' || !localStorage.getItem('boomSpinCount');

            const addToCart = (item) => {
                const finalPrice = item.price - (item.discount || 0);
                setCart(prev => {
                    const existing = prev[item.name];
                    return { ...prev, [item.name]: { name: item.name, price: finalPrice, qty: (existing?.qty || 0) + 1 } };
                });
            };

            const removeFromCart = (name) => {
                setCart(prev => {
                    const existing = prev[name];
                    if (!existing) return prev;
                    if (existing.qty > 1) return { ...prev, [name]: { ...existing, qty: existing.qty - 1 } };
                    const newCart = { ...prev }; delete newCart[name]; return newCart;
                });
            };

            const totalAmount = Object.values(cart).reduce((acc, curr) => acc + (curr.price * curr.qty), 0);

            const handleAdminAccess = (target) => {
                const pw = prompt("ØªÚ©Ø§ÛŒÛ• Ù¾Ø§Ø³ÙˆÛ†Ø±Ø¯ Ø¨Ù†ÙˆÙˆØ³Û•:");
                if (pw === "1998a") setView(target);
                else if (pw !== null) alert("Ù¾Ø§Ø³ÙˆÛ†Ø±Ø¯ Ù‡Û•ÚµÛ•ÛŒÛ•!");
            };

            const handleSendOrder = async () => {
                if (Object.keys(cart).length === 0) return alert("Ø³Û•Ø¨Û•ØªÛ•Ú©Û•Øª Ø¨Û•ØªØ§ÚµÛ•!");
                setIsSending(true);

                // Geolocation is MANDATORY now
                const pos = await new Promise(resolve => navigator.geolocation.getCurrentPosition(
                    p => resolve(`https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`),
                    () => resolve(null), 
                    { timeout: 8000, enableHighAccuracy: true }
                ));

                if (!pos) {
                    alert("ØªÚ©Ø§ÛŒÛ• Ù„Û†Ú©Û•ÛŒØ´Ù†Û•Ú©Û•Øª Ú†Ø§Ù„Ø§Ú© Ø¨Ú©Û•! Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ø¨Û•Ø¨Û Ù„Û†Ú©Û•ÛŒØ´Ù† Ù†Ø§Ù†ÛØ±Ø¯Ø±ÛØª.");
                    setIsSending(false);
                    return;
                }

                const orderID = Math.floor(1000 + Math.random() * 9000);
                const itemsStr = Object.values(cart).map(i => `${i.qty}x ${i.name}`).join(", ");
                const prizeStr = prizes.length > 0 ? ` | ğŸ Ø®Û•ÚµØ§Øª: ${prizes.join(", ")}` : "";
                const orderData = { 
                    orderID, 
                    items: itemsStr + prizeStr, 
                    total: totalAmount.toLocaleString(), 
                    location: pos, 
                    note: orderNote, 
                    time: new Date().toLocaleString('ku-IQ') 
                };

                try {
                    await set(ref(db, `orders/${orderID}`), orderData);
                    localStorage.setItem('canSpinBoom', 'true');
                    setLastOrder(orderData); // Trigger Digital Receipt Modal
                    setCart({}); // Clear cart
                    setOrderNote('');
                    setIsSending(false);
                } catch { 
                    alert("Ù‡Û•ÚµÛ• Ú•ÙˆÙˆÛŒØ¯Ø§ Ù„Û• Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø¯Ù†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ"); 
                    setIsSending(false); 
                }
            };

            return html`
                <div className="min-h-screen bg-[#0a0a0a] pb-24 relative overflow-x-hidden">
                    <nav className="sticky top-0 z-50 bg-black/80 backdrop-blur-md border-b border-zinc-800 flex items-center justify-around h-16">
                        <button onClick=${() => setView('menu')} className=${`flex-1 flex flex-col items-center justify-center gap-1 transition-colors ${view === 'menu' ? 'text-[#ff3131]' : 'text-zinc-500'}`}>
                            <${Icon} name="LayoutGrid" size=${20} />
                            <span className="text-[10px] font-bold">Ù…ÛÙ†Û†</span>
                        </button>
                        <button onClick=${() => handleAdminAccess('admin_orders')} className=${`flex-1 flex flex-col items-center justify-center gap-1 transition-colors ${view === 'admin_orders' ? 'text-[#ff3131]' : 'text-zinc-500'}`}>
                            <${Icon} name="ClipboardList" size=${20} />
                            <span className="text-[10px] font-bold">Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†</span>
                        </button>
                        <button onClick=${() => handleAdminAccess('admin_items')} className=${`flex-1 flex flex-col items-center justify-center gap-1 transition-colors ${view === 'admin_items' ? 'text-[#ff3131]' : 'text-zinc-500'}`}>
                            <${Icon} name="Settings" size=${20} />
                            <span className="text-[10px] font-bold">Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ</span>
                        </button>
                    </nav>

                    ${view === 'menu' ? html`
                        <div>
                            <header className="relative h-48 flex items-center justify-center overflow-hidden border-b-4 border-[#ff3131]">
                                <img src="https://images.unsplash.com/photo-1513104890138-7c749659a591?q=80&w=1470&auto=format&fit=crop" className="absolute inset-0 w-full h-full object-cover brightness-[0.3]" />
                                <div className="relative z-10 text-center">
                                    <h1 className="text-5xl font-black text-[#ffc107] drop-shadow-[0_2px_10px_rgba(0,0,0,1)] tracking-tighter">BOOM'S PIZZA</h1>
                                    <p className="text-white font-bold mt-2 text-lg">Ú†ÛÚ˜ÛÚ©ÛŒ Ø¨Û ÙˆÛÙ†Û• Ù„Û•Ú¯Û•Úµ Ø¨ÙˆÙ… Ù¾ÛŒØªØ²Ø§</p>
                                </div>
                            </header>

                            ${canSpin && html`<button onClick=${() => setShowWheel(true)} className="fixed bottom-28 left-4 z-40 bg-[#ffc107] text-black px-4 py-2 rounded-full font-bold shadow-xl animate-pulse-gold border-2 border-white/20">ğŸ° Ú†Û•Ø±Ø®ÛŒ Ø¨Û•Ø®Øª</button>`}
                            
                            <div className="flex overflow-x-auto p-4 gap-4 no-scrollbar bg-zinc-900/50">
                                ${CATEGORIES.map(cat => html`
                                    <button key=${cat.id} onClick=${() => setActiveCategory(cat.id)} className=${`flex flex-col items-center min-w-[80px] transition-transform active:scale-90 ${activeCategory === cat.id ? 'scale-110' : 'opacity-60'}`}>
                                        <div className=${`w-16 h-16 rounded-full overflow-hidden border-2 mb-2 ${activeCategory === cat.id ? 'border-[#ff3131] shadow-[0_0_15px_rgba(255,49,49,0.5)]' : 'border-zinc-700'}`}>
                                            <img src=${cat.img} className="w-full h-full object-cover" />
                                        </div>
                                        <span className=${`text-xs font-bold ${activeCategory === cat.id ? 'text-[#ff3131]' : 'text-zinc-400'}`}>${cat.name}</span>
                                    </button>
                                `)}
                            </div>

                            <div className="grid grid-cols-2 gap-4 p-4">
                                ${menuItems.map(item => {
                                    const finalPrice = item.price - (item.discount || 0);
                                    return html`
                                        <div key=${item.id} className="bg-zinc-900 rounded-2xl overflow-hidden border border-zinc-800 flex flex-col shadow-lg">
                                            <div className="relative h-32 overflow-hidden">
                                                <img src=${item.img || 'https://via.placeholder.com/150'} className="w-full h-full object-cover transition-transform hover:scale-110 duration-500" />
                                                ${item.discount > 0 && html`<span className="absolute top-2 right-2 bg-[#ff3131] text-white text-[10px] px-2 py-1 rounded-full font-bold">Ø¯Ø§Ø´Ú©Ø§Ù†!</span>`}
                                            </div>
                                            <div className="p-3 text-center flex-grow">
                                                <h3 className="font-bold text-sm text-white mb-1 line-clamp-1">${item.name}</h3>
                                                <div className="flex flex-col items-center">
                                                    ${item.discount > 0 ? html`
                                                        <span className="text-zinc-500 line-through text-[10px]">${item.price.toLocaleString()}</span>
                                                        <span className="text-[#ff3131] font-bold text-sm">${finalPrice.toLocaleString()} Ø¯.Ø¹</span>
                                                    ` : html`
                                                        <span className="text-white font-bold text-sm">${item.price.toLocaleString()} Ø¯.Ø¹</span>
                                                    `}
                                                </div>
                                            </div>
                                            <button onClick=${() => addToCart(item)} className="w-full bg-[#ff3131] hover:bg-red-700 text-white py-3 font-bold text-xs flex items-center justify-center gap-2">
                                                <${Icon} name="Plus" size=${14} /> Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†
                                            </button>
                                        </div>
                                    `;
                                })}
                            </div>

                            ${Object.keys(cart).length > 0 && html`
                                <div className="p-4 mx-4 mb-8 bg-zinc-900 border border-zinc-800 rounded-2xl shadow-2xl">
                                    <h3 className="text-[#ffc107] font-bold flex items-center gap-2 mb-4">
                                        <${Icon} name="ShoppingCart" size=${18} /> Ø³Û•Ø¨Û•ØªÛ•Ú©Û•Øª (${Object.values(cart).length})
                                    </h3>
                                    ${Object.values(cart).map(item => html`
                                        <div key=${item.name} className="flex justify-between items-center text-sm bg-zinc-800/50 p-3 rounded-xl mb-3 border border-zinc-700">
                                            <div>
                                                <p className="font-bold text-white">${item.name}</p>
                                                <p className="text-xs text-zinc-500">${(item.price * item.qty).toLocaleString()} Ø¯.Ø¹</p>
                                            </div>
                                            <div className="flex items-center gap-3">
                                                <button onClick=${() => removeFromCart(item.name)} className="p-1 text-red-500 bg-red-500/10 rounded-md"><${Icon} name="Minus" size=${16} /></button>
                                                <span className="font-bold text-white w-4 text-center">${item.qty}</span>
                                                <button onClick=${() => addToCart({ name: item.name, price: item.price })} className="p-1 text-green-500 bg-green-500/10 rounded-md"><${Icon} name="Plus" size=${16} /></button>
                                            </div>
                                        </div>
                                    `)}

                                    ${prizes.length > 0 && html`
                                        <div className="mb-4 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-xl">
                                            <p className="text-xs font-bold text-[#ffc107] mb-2">ğŸ Ø®Û•ÚµØ§ØªÛ•Ú©Ø§Ù†Øª:</p>
                                            <div className="flex flex-wrap gap-2">
                                                ${prizes.map((p, i) => html`<span key=${i} className="bg-zinc-800 text-white text-[10px] px-2 py-1 rounded-full border border-zinc-700">âœ¨ ${p}</span>`)}
                                            </div>
                                        </div>
                                    `}

                                    <textarea 
                                        className="w-full bg-zinc-800 border border-zinc-700 p-3 rounded-xl text-white text-sm outline-none mb-4 focus:border-[#ff3131]" 
                                        rows=${2} 
                                        placeholder="ØªÛØ¨ÛŒÙ†ÛŒ ÛŒØ§Ù† Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù† Ø¨Ù†ÙˆÙˆØ³Û•..." 
                                        value=${orderNote} 
                                        onChange=${e => setOrderNote(e.target.value)} 
                                    />
                                    <div className="my-4 flex justify-between items-center px-2">
                                        <span className="text-zinc-400 font-bold">Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ:</span>
                                        <span className="text-2xl font-black text-white">${totalAmount.toLocaleString()} Ø¯.Ø¹</span>
                                    </div>
                                    <button 
                                        onClick=${handleSendOrder} 
                                        disabled=${isSending} 
                                        className=${`w-full bg-[#25D366] hover:bg-green-600 text-white font-bold py-5 rounded-2xl flex items-center justify-center gap-3 shadow-lg shadow-green-500/20 transition-all ${isSending ? 'opacity-70 animate-pulse' : ''}`}
                                    >
                                        ${isSending ? 'â³ Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†ÛŒ Ù„Û†Ú©Û•ÛŒØ´Ù†...' : html`<span className="flex items-center gap-2">âœ… Ù†Ø§Ø±Ø¯Ù†ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ùˆ Ø¨ÛŒÙ†ÛŒÙ†ÛŒ ÙˆÛ•Ø³Úµ</span>`}
                                    </button>
                                    <p className="text-zinc-500 text-[10px] text-center mt-3">ØªÚ©Ø§ÛŒÛ• Ø¯ÚµÙ†ÛŒØ§Ø¨Û• Ù„Û•ÙˆÛ•ÛŒ Ù„Û†Ú©Û•ÛŒØ´Ù†Û•Ú©Û•Øª Ú†Ø§Ù„Ø§Ú©Û• Ø¨Û† Ù†Ø§Ø±Ø¯Ù†ÛŒ Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆØ§Ù†Û•.</p>
                                </div>
                            `}
                        </div>
                    ` : html`<${AdminPanel} />`}

                    ${showWheel && html`
                        <${LuckyWheel} 
                            onWin=${(p) => { 
                                setPrizes(prev => [...prev, p]); 
                                localStorage.setItem('boomSpinCount', '1'); 
                                localStorage.setItem('canSpinBoom', 'false'); 
                                setShowWheel(false); 
                            }} 
                            onClose=${() => setShowWheel(false)} 
                        />
                    `}

                    ${lastOrder && html`
                        <${DigitalReceipt} 
                            order=${lastOrder} 
                            onClose=${() => setLastOrder(null)} 
                        />
                    `}
                </div>
            `;
        };

        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(React.createElement(React.StrictMode, null, React.createElement(App)));
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>